# 01 관계 데이터 모델

데이터 모델 중 관계 데이터모델에 대해서 알아본다.
```
* 용어 정리

relation - 행과 열로 구성된 테이블, 릴레이션을 의미한다. 이 용어는 한글로 번역시 관계라고 하지 않는다.
relationship - 행과 열로 구성된 테이블을 의미하는 것이 아닌 '관계' 라는 용어를 나타낸다.

릴레이션을 한글로 번역하면 '관계' 가 되지만 '관계' 라는 용어는 다른 의미로 사용되기 때문에 릴레이션과 릴레이션십을
서로 구분하듯이 릴레이션(테이블) 과 '관계' 라는 단어 또한 구분해서 사용한다.

relation data model - 관계 데이터 모델
relational database - 관계 데이터베이스
relational algebra - 관계 대수
```
## 릴레이션 
```
* 테이블 예제

도서번호  |  도서 이름  |  출판사  |  가격
1         축구의 역사     굿스포츠   7000
2         축구아는 여자    나무수    13000
3         축구의 이해    대한미디어  22000
4         골프 바이블    대한미디어  35000 
5         피겨 교본       굿스포츠    8000
```
```
위 테이블은 4 개의 속성(도서 번호, 도서 이름, 출판사, 가격) 집합이 있고 각 집합별로 5 개의 원소가 있다.

첫 번째 행은 (1, 축구의 역사, 굿스포츠, 7000) 네 개의 집합에서 원소가 하나씩 있으며 네 개의 원소들이 관계(relational) 를
맺고 있다. 테이블 전체로 보면 도서 테이블(relation) 은 이러한 관계(relational) 다섯 개가 모여서 생성되었다고 말할 수 있다.
```
### 관계를 설명하는 두 가지 개념 
```
첫 번째로 관계는 앞서 설명한 릴레이션 내에서 원소들이 결속되는 관계가 있고, 두 번째로는 릴레이션 간의 관계로써 하나의 릴레이션 내에서
다른 릴레이션을 식별할 수 있는 값(원소) 으로 식별 가능한 값을 서로 연결하는 관계가 있다.

도서(도서번호, 도서이름, 출판사 가격)
주문(도서번호, 고객번호, 판매가격, 주문일자)
고객(고객번호, 이름, 주민번호, 주소, 핸드폰)

각각의 릴레이션 속성들은 공통된 식별값(원소) 을 가지고 서로 연결된다. 
```
### 릴레이션의 세부 구성
```
* 릴레이션 스키마

릴레이션 스키마는 릴레이션에 어떤 정보가 담길지 정의한다. == CREATE TABLE (릴레이션의 속성을 정의하는 것) 

속성 - 릴레이션 스키마의 열 // 속성은 열(column) 이라고도 한다.
도메인 - 속성이 가질 수 있는 값의 집합 // 숫자를 가질 수 있는지 문자를 가질 수 있는지 등등 76 p
차수 - 속성의 개수


도서의 릴레이션 스키마 표현 예시 - 도서(도서번호, 도서이름, 출판사, 가격)
```
```
* 서로 다른 용어로 사용되는 같은 개념들

(스키마, 내포, 헤더) // 속성 정의를 나타냄 
(릴레이션, 테이블, 파일)
(인스턴스, 외연, 데이터) // 알맹이
(투플, 행, 레코드) 
(속성, 열, 필드)

투플 - 릴레이션의 행
카디날리티 - 투플의 수 
```
### 릴레이션의 특징
```
1. 속성은 단일 값을 가진다.
2. 속성은 서로 다른 이름을 가진다.
3. 한 속성의 값은 모두 같은 도메인 값을 가진다. 속성에서 정의한 도메인 값만 가질 수 있다.
4. 속성의 순서는 상관 없다.
5. 릴레이션 내의 중복된 투플(행) 은 허용하지 않는다.
6. 투플(행) 의 순서는 상관없다.


tip - 관계 데이터 모델을 컴퓨터 시스템에 구현한 것을 관계 데이터베이스 시스템이라고 한다.
```
# 02 무결성 제약 조건

데이터의 삽입,삭제,수정 시 여러가지 제약조건으로 데이터의 일관성을 유지하고 중복을 제거해서 신뢰도를 유지해야 한다. 

## 키 
```
키는 투플을 유일하게 식별할 수 있게 해주는 값으로써 하나의 속성 혹은 속성의 집합으로 구성할 수 있다. (중복되지 않아야 한다.)

앞서 설명했듯 테이블은 중복 투플을 허용하지 않기 때문에 키가 되는 단일 속성 또는 속성의 집합을 유일한 식별 값으로 만들어서 서로 다른
투플을 구분할 수 있게 한다. 또한 키는 릴레이션 간의 관계를 맺을 때도 사용된다.
```
### 키의 종류
```
1. 슈퍼키

투플을 유일하게 식별할 수 있게 해주는 하나의 속성 혹은 속성의 집합. 속성 중 유일하게 식별할 수 있는 값으로 하나 또는
여러 개의 속성을 조합한 슈퍼키를 만들 수 있다.

속성의 조합으로 슈퍼키를 만들 때는 유일한 값 외의 포함하지 않아도 되는 속성이 포함된다.

ex) 유일하게 식별할 수 있는 주민번호와 고객 번호로 슈퍼키를 만들기
(주민번호), (주민번호, 이름), (주민번호, 이름, 주소) ...
(고객번호), (고객번호, 이름), (고객번호, 이름, 주소) ...
```
```
2. 후보키

후보키란 투플을 유일하게 식별할 수 있는 속성의 최소 집합을 의미한다. 예를들면 (주민번호) (고객번호)는 중복되지 않는 유일한
값이므로 후보키가 된다. 보통 특별한 언급이 없으면 키라고 지칭되는 것은 후보키이다.

앞서 살펴본 슈퍼키는 유일한 값 외의 포함하지 않아도 되는 속성이 포함될 수 있다 (주민번호, 이름) 이런식으로 하지만 후보키는
없어도 되는 속성이 포함되면 안 된다.

비즈니스 요구사항에 따라 후보키는 복합키(두 개의 속성이 합쳐진 키) 로 구성될 수도 있다. 예를들면 한 명의 고객이 여러 종류의
도서를 구입할 수 있지만, 한 권씩만 구입할 수 있는 경우 즉 중복 구입을 할 수 없으면 후보키는 복합키로 구성된다.

(고객번호) 를 후보키로 사용할 경우 한 명의 고객이 중복으로 도서를 구입하게 되면 투플을 식별할 수 없으며
(도서번호) 를 후보키로 사용하더라도 중복 주문된다면 투플을 식별할 수 없게된다.

(물론 이 경우 애플리케이션 수준에서 중복 구입을 하지 못하게 막을 수도 있지만 단순히 데이터베이스 관점에서 생각한다.)

이런 경우 (고객번호, 도서번호) 를 하나로 묶어서 후보키를 복합키로 사용할 수 있다. 
```
```
3. 기본키 (PK)

기본키는 여러 '후보키' 중 하나를 선정하여 대표로 삼는 키를 말한다. 후보키가 하나라면 그 후보키가 기본키가 되며 여러개일 경우
릴레이션의 특성에 따라서 하나를 선택한다.

* 기본 키 제약 조건

- 투플을 식별할수 있는 고유한 값이어야 한다. (유일한 값)
- NULL 값을 허용하지 않는다.
- 키 값의 변동이 일어나지 않아야 한다.
- 최대한 적은 수의 속성을 가져야 한다.
- 향후 키를 사용하는 데 있어서 문제 발생 소지가 없어야 한다.
(예를 들면 주민번호를 기본 키로 사용했는데 개인정보 보호 정책에 의해 사용할 수 없게되면 안 된다. 보통 인위적인 키를 기본 키로 사용한다.)
```
```
4. 대리키

인위적으로 만든 키 DBMS 나 관련 소프트웨어에서 인위적으로 생성하는 값을 사용한다. 복합키를 사용하거나 문제발생의 소지가 있는 키를
기본 키로 사용하는 대리키를 사용할 수 있다. 예를 들면 주문 번호를 만들어서 사용하는 경우가 있다. 
```
```
5. 대체키

대체키는 기본 키로 선정되지 않은 후보키를 말한다. 
```
```
6. 외래키 (FK)

외래키는 다른 릴레이션의 기본키 PK 를 참조하는 속성을 말한다. 릴레이션 간의 관계(relationship) 을 표현할 때 사용 한다.
참조하는 외래키와 참조되는 기본키의 양쪽 릴레이션의 도메인은 서로 같아야 한다. 기본키 값이 변경되면 외래키의 값이 변경된다.

기본키와 다르게 null 값과 중복 값을 허용하며 자기 자신의 기본키를 릴레이션 내에서 참조하는 외래키로 사용할 수도 있다.

* 외래키는 기본 키의 일부가 될 수도 있다. 또한 외래키를 기본키에 포함하여 복합 기본키가 되는 경우가 있는데 대리키를 추가하기
전의 주문 릴레이션의 예가 이 경우에 해당한다. 86 p

주문 릴레이션에서 (주문번호) 를 대리키로 사용하는 대신 (고객번호, 도서번호) 두 개의 외래 키가 복합 기본키가 된다. 
```
## 무결성 제약 조건 알아보기
```
* 도메인 무결성 제약 조건 (속성)

릴레이션 내의 투플들이 각 속성의 도메인에 지정된 값만 가져야 한다는 조건이다. 일반적인 프로그래밍 언어의 변수형
선언과 개념이 유사하다.
```
```
* 개체 무결성 제약 조건 (투플)

투플의 기본키를 제약하는 조건으로써 기본키 제약이라고도 한다. NULL 값을 허용하지 않으며 릴레이션 내에서 오직 하나의
값만 존재해야 하는 제약으로 투플의 삽입/수정 시 제약사항을 우선 확인한다.

기본키 제약 조건에서 기본키를 삭제하는 경우 특별한 확인이 필요하지 않지만, 기본키를 다른 릴레이션에서 참조하고 있다면
바로 삭제되지 않는다. 
```
```
* 참조 무결성 제약 조건 (속성과 투플)

참조 무결성 제약 조건은 앞선 도메인 및 개체 무결성 제약 조건이 적용되고 난 후에 조건을 적용한다. 

외래키 제약 조건으로써 릴레이션 간의 참조 관계를 선언하는 제약 조건이다. 참조되는 릴레이션(PK) 을 부모 릴레이션, 참조하는
릴레이션을(FK) 자식 릴레이션이라고 한다.

외래키 제약 조건으로는 부모 릴레이션의 기본키 도메인과 외래키의 도메인이 동일해야 하며, 자식 릴레이션의 값이 변경될 때
부모 릴레이션에 의한 제약을 받게 된다. 부모 릴레이션의 도메인 제약과 다른 자료형으로 삽입, 수정될 경우 거부되고, 반대로

자식 릴레이션에서 참조하고 있는 값인 외래 키를 부모 릴레이션에서 삭제하거나 다른 값으로 변경하려고 하면 거부된다.

외래키 제약 조건을 가지고 있어도 부모 릴레이션의 PK 값을 참조하지 않고 NULL 값을 사용할 수도 있다.

자식 릴레이션에서 외래키 값을 삭제할 경우 아무런 문제가 없지만, 부모 릴레이션에서 참조되고 있는 기본키 투플이 삭제되는
경우 문제가 발생할 수 있다. 
```
#### + 부모 릴레이션에서 투플을 삭제할 때 참조 무결성 제약 조건을 수행하기 위한 네 가지 옵션
```
이 조건은 부모 릴레이션은 물론 자식 릴레이션에도 지정해주어야 한다. 아래 조건은 MySQL 기준으로 설명한다.

RESTRICTED - 자식 릴레이션에서 참조하고 있을 경우 부모 릴레이션의 삭제 작업을 거부한다.
CASCADE - 자식 릴레이션의 투플을 같이 삭제한다.
DEFAULT - 자식 릴레이션의 투플을 미리 설저애둔 값으로 변경한다.
NULL - 자식 릴레이션 관련 투플을 NULL 값으로 변경한다. (NULL 을 허용한 경우)
```
#### + 참조 무결성 제약 조건 (외래키 제약) 에서 값을 수정하기
```
외래키를 수정하면 삭제와 삽입 명령이 연속해서 수행된다. 각각 삭제 및 삽입 제약조건을 따른다.
```
# 03 관계 대수

관계 대수란 어떤 데이터를 어떻게 찾는지에 대한 처리 절차를 명시하는 절차적 언어로써 DBMS 내부의 처리 언어로 사용된다.

대수란 수를 대신한다는 명칭 그대로 수를 대신해서 문자를 사용하는 방법으로, 방정식을 푸는 방법을 연구하는 학문이다. 94 p

#### + 관계(relation) 의 수학적 의미 (수학에서 정의하는 릴레이션이란?)
```
관계 데이터베이스는 릴레이션이라는 수학적 개념에 기초하는데 여기서 간단하게 릴레이션에 대해서 설명한다.

집합은 숫자, 사람, 문자 등 객체의 모임이다. 두 개의 집합 A = {2,4} B = {1, 3, 5} 가 있다고 가정했을 때

카티전 프로덕트 (각 집합의 원소를 각 성분으로 하는 튜플들의 집합이다. 쉽게 말해서 집합으로 만들 수 있는 모든 원소(튜플) 의 개수) 는
두 집합의 곱인 A * B 가 된다. 

릴레이션 R 은 카티전 프로적트의 부분 집합으로 정의한다. R1 = {(2,1), (4,1)}  R2 = {(2,1), (2,3), (2,5)} ... 등등
여러 가지의 릴레이션을 만들 수 있다. 이때 원소의 개수가 n 개인 집합 S 의 총 릴레이션 (부분 집합) 의 개수는 2 의 n 승이 된다.

(카티전 프로덕트의 부분 집합으로 만들 수 있는 부분 집합의 경우의 수를 의미한다.)

카티전 프로덕트 A * B 의 부분 집합의 개수를 구하려면 2 의 A * B 제곱으로 구할 수 있다 (2 A * B) 앞서 설명한 경우는
2 의 6 제곱 즉 64 개의 릴레이션 R 을 만들 수 있게 된다. 

쉽게 말해서 수학에서 의미하는 릴레이션이란 집합의 원소에서 만들 수 있는 집합의 경우의 수를 뜻한다.

릴레이션은 카티전 프로덕트의 부분 집합이라고 하였는데, 릴레이션 역시 집합이 되므로 집합에서 가능한 연산을 사용할 수 있다.
(합집합, 교집합, 카티전 프로덕트 등등) 95 p

참고로 카티전 프로덕트의 기초 집합 A, B 각각이 가질 수 있는 값의 범위를 도메인이라고 한다. A 의 도메인은 {2, 4} 가 된다. 
```
### 수학적 릴레이션의 개념을 데이터베이스에 적용해보기
```
학번 = {2, 4}
과목 = {데이터베이스, 자료구조, 프로그래밍}

카티전 프로덕트 = 6 (집합의 원소 개수)
총 릴레이션 = 64 (카티전 프로덕트의 집합으로 만들수 있는 집합의 개수)

직관적으로 설명하자면 아래 처럼 나열할 수 있다.

2 데이터베이스
2 자료구조
2 프로그래밍
4 데이터베이스
4 자료구조
4 프로그래밍

이것은 카티전 프로덕트로 구한 집합의 원소 값이며 하나의 릴레이션(테이블) 이 된다. 여기서 총 릴레이션의 개수를 구하면
64 개가 되는데 이 릴레이션의 개수는 앞서 설명했듯이 카티전 프로덕트 집합으로 만들 수 있는 집합(테이블) 의 개수가 된다.

2 데이터베이스
2 자료구조

2 자료구조
2 프로그래밍
4 데이터베이스

이런 식으로 여러 개의 집합 테이블로 다시 나눌 수 있다. 
```
## 관계 대수 연산자

수학에서 연산자란 피연산자에 적용되는 연산 기호를 말한다. ex) 2 + 3 




